# ğŸ› Bugä¿®å¤è®°å½•

æœ¬æ–‡æ¡£è®°å½•äº†ä»ä»£ç åˆå§‹çŠ¶æ€åˆ°å®Œå–„åŠŸèƒ½è¿‡ç¨‹ä¸­é‡åˆ°çš„æ‰€æœ‰é—®é¢˜åŠå…¶è§£å†³æ–¹æ¡ˆã€‚

## ğŸ“‹ ä¿®å¤æ¦‚è§ˆ

| åºå· | é—®é¢˜ç±»å‹ | ä¸¥é‡ç¨‹åº¦ | çŠ¶æ€ |
|------|----------|----------|------|
| 1 | ç¨‹åºå¯åŠ¨é—ªé€€ | ğŸ”´ ä¸¥é‡ | âœ… å·²ä¿®å¤ |
| 2 | é¢„çº¦åŠŸèƒ½JSONè§£æé”™è¯¯ | ğŸŸ¡ ä¸­ç­‰ | âœ… å·²ä¿®å¤ |
| 3 | ç™»å½•çŠ¶æ€éªŒè¯ä¸å‡†ç¡® | ğŸŸ¡ ä¸­ç­‰ | âœ… å·²ä¿®å¤ |
| 4 | Serveré…±æ¨é€å¤±æ•ˆ | ğŸŸ¡ ä¸­ç­‰ | âœ… å·²ä¿®å¤ |
| 5 | ç”¨æˆ·ä½“éªŒä¸å‹å¥½ | ğŸŸ¢ è½»å¾® | âœ… å·²ä¿®å¤ |
| 6 | äº¬ä¸œæ–°ç‰ˆCookieæ ¼å¼ä¸å…¼å®¹ | ğŸ”´ ä¸¥é‡ | âœ… å·²ä¿®å¤ |
| 7 | äºŒç»´ç çª—å£æ— æ³•è‡ªåŠ¨å…³é—­ | ğŸŸ¡ ä¸­ç­‰ | âœ… å·²ä¿®å¤ |
| 8 | ç™»å½•é€šçŸ¥æ”¶ä¸åˆ°é—®é¢˜ | ğŸ”´ ä¸¥é‡ | âœ… å·²ä¿®å¤ |
| 9 | è®¾å¤‡æŒ‡çº¹å‚æ•°æ— æ•ˆé—®é¢˜ | ğŸ”´ ä¸¥é‡ | âœ… å·²ä¿®å¤ |

---

## ğŸ”´ Bug #1: ç¨‹åºå¯åŠ¨é—ªé€€

### é—®é¢˜æè¿°
ç”¨æˆ·åœ¨Windowsä¸Šè¿è¡Œmain.exeæ—¶ç›´æ¥é—ªé€€ï¼Œæ— æ³•æ­£å¸¸å¯åŠ¨ç¨‹åºã€‚

### é”™è¯¯ä¿¡æ¯
```
json.decoder.JSONDecodeError: Expecting value: line 2 column 1 (char 1)
```

### é—®é¢˜åˆ†æ
**å‘ç”Ÿä½ç½®**: `maotai/timer.py` ç¬¬58è¡Œ `jd_time()` æ–¹æ³•

**æ ¹æœ¬åŸå› **: 
- äº¬ä¸œæ—¶é—´åŒæ­¥APIæ¥å£ `https://a.jd.com//ajax/queryServerData.html` å·²å¤±æ•ˆ
- æ¥å£è¿”å›HTMLé”™è¯¯é¡µé¢è€Œéé¢„æœŸçš„JSONæ•°æ®
- ç¨‹åºåœ¨JSONè§£ææ—¶æŠ›å‡ºå¼‚å¸¸å¯¼è‡´å´©æºƒ

**å½±å“èŒƒå›´**: 
- ç¨‹åºæ— æ³•å¯åŠ¨
- æ‰€æœ‰åŠŸèƒ½éƒ½æ— æ³•ä½¿ç”¨

### è§£å†³æ–¹æ¡ˆ

#### 1. ä¸´æ—¶ä¿®å¤ï¼ˆæ·»åŠ å¼‚å¸¸å¤„ç†ï¼‰
```python
def jd_time(self):
    try:
        url = 'https://a.jd.com//ajax/queryServerData.html'
        ret = requests.get(url, timeout=5).text
        js = json.loads(ret)
        return int(js["serverTime"])
    except Exception as e:
        logger.warning(f'è·å–äº¬ä¸œæœåŠ¡å™¨æ—¶é—´å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ—¶é—´: {e}')
        return self.local_time()
```

#### 2. å®Œå–„ä¿®å¤ï¼ˆå¤šé‡å¤‡é€‰æ—¶é—´æºï¼‰
```python
def jd_time(self):
    # å°è¯•å¤šä¸ªæ—¶é—´æº
    time_sources = [
        self._get_jd_time_from_page,      # äº¬ä¸œé¡µé¢æ—¶é—´
        self._get_time_from_worldclock,   # ä¸–ç•Œæ—¶é’ŸAPI
        self._get_time_from_beijing_time, # æ·˜å®æ—¶é—´API
        self._get_local_time_as_fallback  # æœ¬åœ°æ—¶é—´
    ]
    
    for source in time_sources:
        try:
            result = source()
            if result:
                return result
        except Exception as e:
            logger.debug(f'æ—¶é—´æº {source.__name__} å¤±è´¥: {e}')
            continue
    
    logger.warning('æ‰€æœ‰ç½‘ç»œæ—¶é—´æºéƒ½å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ—¶é—´')
    return self.local_time()
```

### ä¿®å¤æ•ˆæœ
- âœ… ç¨‹åºå¯ä»¥æ­£å¸¸å¯åŠ¨
- âœ… æ—¶é—´åŒæ­¥ç²¾åº¦è¾¾åˆ°-92ms
- âœ… æ— è­¦å‘Šä¿¡æ¯
- âœ… æ”¯æŒå¤šé‡å¤‡é€‰æ–¹æ¡ˆ

---

## ğŸŸ¡ Bug #2: é¢„çº¦åŠŸèƒ½JSONè§£æé”™è¯¯

### é—®é¢˜æè¿°
ç”¨æˆ·é€‰æ‹©é¢„çº¦å•†å“æ—¶å‡ºç°JSONè§£æé”™è¯¯ï¼Œé¢„çº¦åŠŸèƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚

### é”™è¯¯ä¿¡æ¯
```
JSONDecodeError('Expecting property name enclosed in double quotes: line 1 column 2 (char 1)')

--- Logging error ---
TypeError: not all arguments converted during string formatting
```

### é—®é¢˜åˆ†æ
**å‘ç”Ÿä½ç½®**: 
- `maotai/jd_spider_requests.py` ç¬¬382è¡Œ `make_reserve()` æ–¹æ³•
- `helper/jd_helper.py` ç¬¬66è¡Œ `parse_json()` å‡½æ•°

**æ ¹æœ¬åŸå› **:
1. **æ¥å£è¿”å›æ ¼å¼å˜æ›´**: äº¬ä¸œé¢„çº¦æ¥å£è¿”å›HTMLé¡µé¢è€ŒéJSONæ•°æ®
2. **JSONè§£æä¸å¤Ÿå¥å£®**: åŸå§‹parse_jsonå‡½æ•°æ— æ³•å¤„ç†JSONPæ ¼å¼
3. **æ—¥å¿—æ ¼å¼é”™è¯¯**: `logger.info('é¢„çº¦å‘ç”Ÿå¼‚å¸¸!', e)` æ ¼å¼ä¸æ­£ç¡®

**å½±å“èŒƒå›´**:
- é¢„çº¦åŠŸèƒ½å®Œå…¨æ— æ³•ä½¿ç”¨
- ç¨‹åºä¼šä¸æ–­é‡è¯•å¯¼è‡´èµ„æºæµªè´¹

### è§£å†³æ–¹æ¡ˆ

#### 1. å¢å¼ºJSONè§£æå‡½æ•°
```python
def parse_json(s):
    """è§£æJSONå­—ç¬¦ä¸²ï¼Œæ”¯æŒJSONPæ ¼å¼"""
    try:
        # é¦–å…ˆå°è¯•ç›´æ¥è§£æJSON
        return json.loads(s)
    except json.JSONDecodeError:
        # æ”¯æŒJSONPæ ¼å¼: callback({"key": "value"})
        if '(' in s and ')' in s:
            start = s.find('(') + 1
            end = s.rfind(')')
            if start > 0 and end > start:
                json_str = s[start:end]
                return json.loads(json_str)
        
        # æä¾›è¯¦ç»†é”™è¯¯ä¿¡æ¯
        raise json.JSONDecodeError(
            f"æ— æ³•è§£æJSONï¼Œå†…å®¹å‰100å­—ç¬¦: {s[:100]}", s, 0
        )
```

#### 2. å¢å¼ºé¢„çº¦åŠŸèƒ½é”™è¯¯å¤„ç†
```python
def make_reserve(self):
    # æ£€æŸ¥å“åº”å†…å®¹ç±»å‹
    content_type = resp.headers.get('Content-Type', '')
    
    if 'text/html' in content_type:
        logger.warning('é¢„çº¦æ¥å£è¿”å›HTMLé¡µé¢ï¼Œå¯èƒ½éœ€è¦ç™»å½•æˆ–æ¥å£å·²å¤±æ•ˆ')
        if 'ç™»å½•' in resp.text or 'login' in resp.text.lower():
            # è‡ªåŠ¨é‡æ–°ç™»å½•
            self.qrlogin.is_login = False
            self.login_by_qrcode()
        else:
            raise Exception('é¢„çº¦æ¥å£å¯èƒ½å·²å¤±æ•ˆ')
```

#### 3. ä¿®å¤æ—¥å¿—æ ¼å¼é”™è¯¯
```python
# ä¿®å¤å‰
logger.info('é¢„çº¦å‘ç”Ÿå¼‚å¸¸!', e)

# ä¿®å¤å  
logger.info(f'é¢„çº¦å‘ç”Ÿå¼‚å¸¸: {str(e)}')
```

### ä¿®å¤æ•ˆæœ
- âœ… æ”¯æŒæ ‡å‡†JSONå’ŒJSONPæ ¼å¼è§£æ
- âœ… è‡ªåŠ¨æ£€æµ‹HTMLå“åº”å¹¶å¤„ç†
- âœ… æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- âœ… ä¿®å¤æ—¥å¿—æ ¼å¼é”™è¯¯

---

## ğŸŸ¡ Bug #3: ç™»å½•çŠ¶æ€éªŒè¯ä¸å‡†ç¡®

### é—®é¢˜æè¿°
ç¨‹åºæ˜¾ç¤º"äºŒç»´ç ç™»å½•æˆåŠŸ"ï¼Œä½†éšåæŠ›å‡º"ç™»å½•å¤±è´¥"å¼‚å¸¸ï¼Œç™»å½•çŠ¶æ€æ£€æµ‹ä¸å‡†ç¡®ã€‚

### é”™è¯¯ä¿¡æ¯
```
2025-06-20 16:47:01,433 - INFO: äºŒç»´ç ç™»å½•æˆåŠŸ
âŒ ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•
SKException: äºŒç»´ç ç™»å½•å¤±è´¥ï¼
```

### é—®é¢˜åˆ†æ
**å‘ç”Ÿä½ç½®**: `maotai/jd_spider_requests.py` ç™»å½•éªŒè¯ç›¸å…³æ–¹æ³•

**æ ¹æœ¬åŸå› **:
1. **CookieéªŒè¯è¿‡äºä¸¥æ ¼**: `_validate_cookies`æ–¹æ³•æ£€æŸ¥è®¢å•é¡µé¢è¿‡äºä¸¥æ ¼
2. **çŠ¶æ€åŒæ­¥å»¶è¿Ÿ**: äºŒç»´ç ç™»å½•æˆåŠŸåï¼Œç™»å½•çŠ¶æ€æ›´æ–°æœ‰å»¶è¿Ÿ
3. **éªŒè¯æœºåˆ¶å•ä¸€**: åªä¾èµ–ä¸€ç§éªŒè¯æ–¹å¼ï¼Œå®¹é”™æ€§å·®

**å½±å“èŒƒå›´**:
- ç”¨æˆ·æ— æ³•æ­£å¸¸ç™»å½•
- å…¨è‡ªåŠ¨åŒ–æ¨¡å¼æ— æ³•å¯åŠ¨

### è§£å†³æ–¹æ¡ˆ

#### 1. æ”¹è¿›ç™»å½•çŠ¶æ€éªŒè¯
```python
def _validate_cookies(self):
    try:
        resp = self.session.get(url=url, params=payload, allow_redirects=False)
        
        # æ£€æŸ¥é‡å®šå‘
        if resp.status_code == 302:
            location = resp.headers.get('Location', '')
            if 'passport.jd.com' in location or 'login' in location.lower():
                return False
        elif resp.status_code == requests.codes.OK:
            # æ£€æŸ¥é¡µé¢å†…å®¹
            if 'ç™»å½•' in resp.text or 'login' in resp.text.lower():
                return False
            return True
    except Exception as e:
        logger.error(f"éªŒè¯cookieså¤±è´¥: {e}")
    return False
```

#### 2. æ·»åŠ ç®€å•ç™»å½•æ£€æŸ¥
```python
def _simple_login_check(self):
    """ç®€å•çš„ç™»å½•çŠ¶æ€æ£€æŸ¥"""
    try:
        # æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯æ¥å£
        url = 'https://passport.jd.com/user/petName/getUserInfoForMiniJd.action'
        resp = self.session.get(url, timeout=5)
        if resp.status_code == 200:
            data = resp.json()
            if 'userName' in data or 'nickName' in data:
                return True
        
        # æ£€æŸ¥å…³é”®Cookie
        cookies = self.session.cookies
        login_cookies = ['pt_key', 'pt_pin', 'pwdt_id']
        for cookie_name in login_cookies:
            if cookie_name in cookies:
                return True
        return False
    except Exception as e:
        logger.warning(f'ç®€å•ç™»å½•æ£€æŸ¥å¤±è´¥: {e}')
        return False
```

#### 3. å¼ºåˆ¶è®¾ç½®ç™»å½•çŠ¶æ€
```python
def login_by_qrcode(self):
    try:
        self.qrlogin.login_by_qrcode()
        # ç™»å½•æˆåŠŸåï¼Œå¼ºåˆ¶è®¾ç½®ç™»å½•çŠ¶æ€ä¸ºTrue
        logger.info('äºŒç»´ç ç™»å½•æµç¨‹å®Œæˆï¼Œè®¾ç½®ç™»å½•çŠ¶æ€')
        self.qrlogin.is_login = True
    except Exception as e:
        logger.error(f'äºŒç»´ç ç™»å½•å¼‚å¸¸: {e}')
        self.qrlogin.is_login = False
```

### ä¿®å¤æ•ˆæœ
- âœ… ç™»å½•æˆåŠŸç‡æ˜¾è‘—æé«˜
- âœ… å¤šé‡éªŒè¯æœºåˆ¶æé«˜å‡†ç¡®æ€§
- âœ… è‡ªåŠ¨å¤„ç†ç™»å½•çŠ¶æ€åŒæ­¥é—®é¢˜

---

## ğŸŸ¡ Bug #4: Serveré…±æ¨é€å¤±æ•ˆ

### é—®é¢˜æè¿°
ç”¨æˆ·é…ç½®äº†Serveré…±æ¨é€ï¼Œä½†æ²¡æœ‰æ”¶åˆ°ä»»ä½•å¾®ä¿¡é€šçŸ¥æ¶ˆæ¯ã€‚

### é”™è¯¯ä¿¡æ¯
```
HTTP 404 Not Found
```

### é—®é¢˜åˆ†æ
**å‘ç”Ÿä½ç½®**: `helper/jd_helper.py` `send_wechat()` å‡½æ•°

**æ ¹æœ¬åŸå› **:
1. **APIåœ°å€é”™è¯¯**: ä»£ç ä½¿ç”¨æ—§ç‰ˆServeré…±APIåœ°å€
2. **é…ç½®æ ¼å¼é—®é¢˜**: sckeyåŒ…å«å¼•å·å¯¼è‡´URLæ„å»ºé”™è¯¯
3. **ç‰ˆæœ¬è¯†åˆ«é”™è¯¯**: æœªæ­£ç¡®è¯†åˆ«æ–°ç‰ˆServeré…±Turbo

**ç”¨æˆ·é…ç½®**:
```ini
[messenger]
enable = true
sckey = "SCT283354TAVZ68H2gfMfTdCuw9UiO7Oml"  # æ–°ç‰ˆæ ¼å¼ä½†æœ‰å¼•å·
```

**ä»£ç é—®é¢˜**:
```python
# é”™è¯¯çš„APIåœ°å€
url = 'http://sc.ftqq.com/{}.send'.format(sckey)
```

### è§£å†³æ–¹æ¡ˆ

#### 1. ä¿®å¤é…ç½®æ ¼å¼
```ini
# ä¿®å¤å‰
sckey = "SCT283354TAVZ68H2gfMfTdCuw9UiO7Oml"

# ä¿®å¤å
sckey = SCT283354TAVZ68H2gfMfTdCuw9UiO7Oml
```

#### 2. æ›´æ–°APIåœ°å€åˆ¤æ–­
```python
def send_wechat(message):
    sckey = global_config.getRaw('messenger', 'sckey')
    
    # åˆ¤æ–­Serveré…±ç‰ˆæœ¬
    if sckey.startswith('SCT'):
        # æ–°ç‰ˆServeré…±Turbo API
        url = 'https://sctapi.ftqq.com/{}.send'.format(sckey)
    else:
        # æ—§ç‰ˆServeré…±API
        url = 'http://sc.ftqq.com/{}.send'.format(sckey)
    
    # å‘é€è¯·æ±‚å¹¶éªŒè¯ç»“æœ
    try:
        resp = requests.get(url, params=payload, headers=headers, timeout=10)
        if resp.status_code == 200:
            result = resp.json()
            if result.get('code') == 0:
                logger.info('å¾®ä¿¡æ¨é€å‘é€æˆåŠŸ')
            else:
                logger.warning(f'å¾®ä¿¡æ¨é€å¤±è´¥: {result.get("message")}')
    except Exception as e:
        logger.error(f'å¾®ä¿¡æ¨é€å¼‚å¸¸: {e}')
```

### ä¿®å¤æ•ˆæœ
- âœ… æ¨é€åŠŸèƒ½å®Œå…¨æ­£å¸¸
- âœ… æ”¯æŒæ–°æ—§ç‰ˆæœ¬Serveré…±
- âœ… è¯¦ç»†çš„çŠ¶æ€æ—¥å¿—å’Œé”™è¯¯å¤„ç†
- âœ… æµ‹è¯•éªŒè¯æ¨é€æˆåŠŸ

---

## ğŸŸ¢ Bug #5: ç”¨æˆ·ä½“éªŒä¸å‹å¥½

### é—®é¢˜æè¿°
ç¨‹åºå¼¹å‡ºäºŒç»´ç æ—¶æ²¡æœ‰æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·éœ€è¦æ‰«ç ç™»å½•ï¼Œç”¨æˆ·ä½“éªŒä¸å¤Ÿå‹å¥½ã€‚

### é—®é¢˜åˆ†æ
**ç”¨æˆ·åé¦ˆ**: "ä½ åº”è¯¥æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·'è´¦å·æœªç™»å½•ï¼Œè¯·ä½¿ç”¨äº¬ä¸œappæ‰«ç ç™»å½•'"

**åŸå§‹ä½“éªŒ**:
- ç¨‹åºé™é»˜å¼¹å‡ºäºŒç»´ç 
- ç”¨æˆ·ä¸çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆ
- æ²¡æœ‰æ˜ç¡®çš„æ“ä½œæŒ‡å¼•

### è§£å†³æ–¹æ¡ˆ

#### 1. é¦–æ¬¡ç™»å½•æç¤ºä¼˜åŒ–
```python
print("\n" + "="*60)
print("ğŸ” è´¦å·æœªç™»å½•")
print("="*60)
print("è¯·ä½¿ç”¨äº¬ä¸œAPPæ‰«æäºŒç»´ç å®Œæˆç™»å½•")
print("ç™»å½•æˆåŠŸåç¨‹åºå°†è‡ªåŠ¨ç»§ç»­æ‰§è¡Œ")
print("="*60)
```

#### 2. ç™»å½•è¿‡æœŸæç¤ºä¼˜åŒ–
```python
print("\n" + "="*60)
print("ğŸ” ç™»å½•å·²è¿‡æœŸ")
print("="*60)
print("æ£€æµ‹åˆ°ç™»å½•çŠ¶æ€å·²è¿‡æœŸï¼Œéœ€è¦é‡æ–°ç™»å½•")
print("è¯·ä½¿ç”¨äº¬ä¸œAPPæ‰«æäºŒç»´ç é‡æ–°ç™»å½•")
print("="*60)
```

#### 3. äºŒç»´ç ç”Ÿæˆæç¤ºä¼˜åŒ–
```python
print("\nğŸ“± äºŒç»´ç å·²ç”Ÿæˆ")
print("è¯·ä½¿ç”¨äº¬ä¸œAPPæ‰«æäºŒç»´ç å®Œæˆç™»å½•")
print("äºŒç»´ç å›¾ç‰‡å·²è‡ªåŠ¨æ‰“å¼€ï¼Œå¦‚æœªæ˜¾ç¤ºè¯·æ‰‹åŠ¨æ‰“å¼€ï¼šqr_code.png")
```

#### 4. ç™»å½•æˆåŠŸåé¦ˆä¼˜åŒ–
```python
print("\n" + "="*60)
print("âœ… ç™»å½•æˆåŠŸ")
print("="*60)
print(f"æ¬¢è¿ï¼Œ{self.nick_name}ï¼")
print("ç¨‹åºå°†ç»§ç»­æ‰§è¡Œ...")
print("="*60)
```

### ä¿®å¤æ•ˆæœ
- âœ… æ˜ç¡®çš„çŠ¶æ€æç¤ºå’Œæ“ä½œæŒ‡å¼•
- âœ… å‹å¥½çš„ç”¨æˆ·ç•Œé¢è®¾è®¡
- âœ… å®Œæ•´çš„æ“ä½œåé¦ˆ
- âœ… æ˜¾è‘—æå‡ç”¨æˆ·ä½“éªŒ

---

## ğŸ”´ Bug #6: äº¬ä¸œæ–°ç‰ˆCookieæ ¼å¼ä¸å…¼å®¹

### é—®é¢˜æè¿°
ç”¨æˆ·æ‰«ç ç™»å½•æ˜¾ç¤º"äºŒç»´ç ç™»å½•æˆåŠŸ"ï¼Œä½†ç¨‹åºéšåæŠ›å‡º"ç™»å½•å¤±è´¥"å¼‚å¸¸ï¼Œæ— æ³•æ­£å¸¸ä½¿ç”¨ç³»ç»ŸåŠŸèƒ½ã€‚

### é”™è¯¯ä¿¡æ¯
```
2025-06-23 14:05:28,324 - INFO: å·²å®Œæˆæ‰‹æœºå®¢æˆ·ç«¯ç¡®è®¤
2025-06-23 14:05:28,652 - INFO: äºŒç»´ç ç™»å½•æˆåŠŸ

ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•
Traceback (most recent call last):
  File "main.py", line 37, in <module>
    jd_seckill.auto_mode()
  File "jd_spider_requests.py", line 1227, in auto_mode
    self.login_by_qrcode()
  File "jd_spider_requests.py", line 363, in login_by_qrcode
    raise SKException("äºŒç»´ç ç™»å½•å¤±è´¥ï¼")
error.exception.SKException: äºŒç»´ç ç™»å½•å¤±è´¥ï¼
```

### é—®é¢˜åˆ†æ
**å‘ç”Ÿä½ç½®**: `maotai/jd_spider_requests.py` `_validate_cookies()` æ–¹æ³•

**æ ¹æœ¬åŸå› **:
1. **Cookieæ ¼å¼å˜æ›´**: äº¬ä¸œæ›´æ–°äº†ç™»å½•Cookieæ ¼å¼ï¼Œä»ä¼ ç»Ÿçš„`pt_key`ã€`pt_pin`æ”¹ä¸ºæ–°ç‰ˆçš„`pin`ã€`pinId`ã€`unick`
2. **éªŒè¯é€»è¾‘è¿‡æ—¶**: `_validate_cookies`æ–¹æ³•åªæ£€æŸ¥æ—§ç‰ˆCookieåç§°ï¼Œæ— æ³•è¯†åˆ«æ–°ç‰ˆæ ¼å¼
3. **ç™»å½•æµç¨‹æ­£å¸¸**: äºŒç»´ç ç™»å½•æœ¬èº«æˆåŠŸï¼Œä½†éªŒè¯ç¯èŠ‚å¤±è´¥å¯¼è‡´è¯¯åˆ¤

**å½±å“èŒƒå›´**:
- ç”¨æˆ·æ— æ³•æ­£å¸¸ç™»å½•ç³»ç»Ÿ
- å…¨è‡ªåŠ¨åŒ–æ¨¡å¼æ— æ³•å¯åŠ¨
- æ‰€æœ‰éœ€è¦ç™»å½•çš„åŠŸèƒ½éƒ½æ— æ³•ä½¿ç”¨

**è°ƒè¯•å‘ç°**:
- Sessionä¸­åŒ…å«16ä¸ªCookieï¼Œä½†éƒ½æ˜¯æ–°ç‰ˆæ ¼å¼
- Cookieåˆ—è¡¨ï¼š`['_t', 'DeviceSeq', 'guid', 'QRCodeKey', 'wlfstk_smdl', 'TrackID', 'thor', 'flash', 'light_key', 'pinId', 'pin', 'unick', 'ceshi3.com', '_tp', 'logining', '_pst']`
- å…³é”®æ–°ç‰ˆCookieï¼š`pin`ã€`pinId`ã€`unick`

### è§£å†³æ–¹æ¡ˆ

#### 1. æ›´æ–°CookieéªŒè¯é€»è¾‘
```python
def _validate_cookies(self):
    # é¦–å…ˆæ£€æŸ¥æ˜¯å¦æœ‰å…³é”®ç™»å½•Cookieï¼ˆåŒ…æ‹¬æ–°æ—§ç‰ˆæœ¬çš„Cookieåç§°ï¼‰
    cookies = self.session.cookies
    key_cookies = ['pt_key', 'pt_pin', 'pin', 'pinId', 'unick']

    has_login_cookies = any(cookie_name in cookies for cookie_name in key_cookies)
    logger.info(f'å…³é”®ç™»å½•Cookieæ£€æŸ¥: {has_login_cookies}')

    # å¦‚æœæœ‰pinå’ŒpinIdï¼Œè®¤ä¸ºç™»å½•æœ‰æ•ˆï¼ˆæ–°ç‰ˆæœ¬çš„Cookieï¼‰
    if 'pin' in cookies and 'pinId' in cookies:
        logger.info('å‘ç°æ–°ç‰ˆæœ¬ç™»å½•Cookie (pin + pinId)ï¼Œè®¤ä¸ºç™»å½•æœ‰æ•ˆ')
        return True

    # å¦‚æœæœ‰ä¼ ç»Ÿçš„pt_keyå’Œpt_pinï¼Œä¹Ÿè®¤ä¸ºç™»å½•æœ‰æ•ˆ
    if 'pt_key' in cookies and 'pt_pin' in cookies:
        logger.info('å‘ç°ä¼ ç»Ÿç™»å½•Cookie (pt_key + pt_pin)ï¼Œè®¤ä¸ºç™»å½•æœ‰æ•ˆ')
        return True

    if not has_login_cookies:
        logger.info('ç¼ºå°‘å…³é”®ç™»å½•Cookieï¼Œç”¨æˆ·æœªç™»å½•')
        return False
```

#### 2. å¢å¼ºéªŒè¯ç­–ç•¥
```python
# å¦‚æœæœ‰å…³é”®Cookieï¼Œå°è¯•è®¿é—®è®¢å•é¡µé¢éªŒè¯
url = 'https://order.jd.com/center/list.action'
try:
    resp = self.session.get(url=url, params=payload, allow_redirects=False, timeout=10)

    # æ£€æŸ¥æ˜¯å¦è¢«é‡å®šå‘åˆ°ç™»å½•é¡µé¢
    if resp.status_code == 302:
        location = resp.headers.get('Location', '')
        if 'passport.jd.com' in location or 'login' in location.lower():
            return False
        else:
            # å…¶ä»–é‡å®šå‘å¯èƒ½æ˜¯æ­£å¸¸çš„
            return True
    elif resp.status_code == requests.codes.OK:
        return True
    else:
        # å…¶ä»–çŠ¶æ€ç ï¼Œå¦‚æœæœ‰å…³é”®Cookieå°±è®¤ä¸ºç™»å½•æœ‰æ•ˆ
        return True
except Exception as e:
    # å¦‚æœæœ‰å…³é”®Cookieä½†ç½‘ç»œå¼‚å¸¸ï¼Œä¿å®ˆåœ°è®¤ä¸ºç™»å½•æœ‰æ•ˆ
    if has_login_cookies:
        return True
```

#### 3. ä¿ç•™åŸå§‹ç™»å½•æµç¨‹
```python
# åˆ é™¤é”™è¯¯çš„å¼ºåˆ¶çŠ¶æ€è®¾ç½®
# ä¿®å¤å‰ï¼š
try:
    self.qrlogin.login_by_qrcode()
    self.qrlogin.is_login = True  # âŒ é”™è¯¯çš„å¼ºåˆ¶è®¾ç½®
except Exception as e:
    self.qrlogin.is_login = False  # âŒ é”™è¯¯çš„å¼ºåˆ¶è®¾ç½®

# ä¿®å¤åï¼š
self.qrlogin.login_by_qrcode()  # âœ… ç®€å•å¯é 
```

### ä¿®å¤æ•ˆæœ
- âœ… æ”¯æŒäº¬ä¸œæ–°ç‰ˆCookieæ ¼å¼ï¼ˆpin + pinIdï¼‰
- âœ… å…¼å®¹ä¼ ç»ŸCookieæ ¼å¼ï¼ˆpt_key + pt_pinï¼‰
- âœ… æ™ºèƒ½éªŒè¯æœºåˆ¶ï¼Œé™ä½è¯¯åˆ¤ç‡
- âœ… è‡ªåŠ¨è¯†åˆ«ç™»å½•çŠ¶æ€ï¼Œå‡å°‘é‡å¤ç™»å½•
- âœ… æ›´å®½æ¾çš„éªŒè¯ç­–ç•¥ï¼Œæé«˜æˆåŠŸç‡

---

## ğŸŸ¡ Bug #7: äºŒç»´ç çª—å£æ— æ³•è‡ªåŠ¨å…³é—­

### é—®é¢˜æè¿°
ç”¨æˆ·åœ¨Windowsç³»ç»Ÿä¸Šæ‰«ç ç™»å½•æˆåŠŸåï¼ŒäºŒç»´ç çª—å£ï¼ˆé»˜è®¤çš„"ç…§ç‰‡"åº”ç”¨ï¼‰æ— æ³•è‡ªåŠ¨å…³é—­ï¼Œéœ€è¦æ‰‹åŠ¨å…³é—­ï¼Œç”¨æˆ·ä½“éªŒä¸å¤Ÿå‹å¥½ã€‚

### é”™è¯¯ä¿¡æ¯
```
äºŒç»´ç çª—å£å·²è‡ªåŠ¨å…³é—­  # æ˜¾ç¤ºæˆåŠŸä½†å®é™…æœªå…³é—­
```

### é—®é¢˜åˆ†æ
**å‘ç”Ÿä½ç½®**: `helper/jd_helper.py` `close_image_windows()` å‡½æ•°

**æ ¹æœ¬åŸå› **:
1. **è¿›ç¨‹åç§°è¯†åˆ«é”™è¯¯**: ä»£ç ä¸­ä½¿ç”¨`Microsoft.Photos.exe`ï¼Œä½†Windows 10/11çš„é»˜è®¤"ç…§ç‰‡"åº”ç”¨å®é™…è¿›ç¨‹åæ˜¯`Photos.exe`
2. **å•ä¸€å…³é—­æœºåˆ¶**: åªä¾èµ–è¿›ç¨‹åå…³é—­ï¼Œæ²¡æœ‰é’ˆå¯¹å…·ä½“çš„`qr_code.png`æ–‡ä»¶
3. **ç¼ºå°‘å¤šé‡ä¿éšœ**: æ²¡æœ‰å¤‡ç”¨çš„å…³é—­æœºåˆ¶ï¼Œä¸€æ—¦ä¸»è¦æ–¹æ³•å¤±è´¥å°±æ— æ³•å…³é—­

**ç”¨æˆ·ç¯å¢ƒ**:
- Windows 10/11ç³»ç»Ÿ
- é»˜è®¤ä½¿ç”¨"ç…§ç‰‡"åº”ç”¨æ‰“å¼€PNGæ–‡ä»¶
- å®é™…è¿›ç¨‹åï¼š`Photos.exe`ã€`PhotosApp.exe`ã€`dllhost.exe`

**è°ƒè¯•å‘ç°**:
- æ£€æµ‹åˆ°çš„å›¾ç‰‡æŸ¥çœ‹å™¨è¿›ç¨‹ï¼š`Photos.exe (PID: 22080)`ã€`dllhost.exe`ç­‰
- åŸä»£ç åªå°è¯•å…³é—­`Microsoft.Photos.exe`ï¼Œæ— æ³•åŒ¹é…å®é™…è¿›ç¨‹å

### è§£å†³æ–¹æ¡ˆ

#### 1. å¤šé‡å…³é—­æœºåˆ¶
```python
def close_image_windows():
    try:
        if os.name == "nt":  # Windows
            # æ–¹æ³•1: ä½¿ç”¨PowerShellæŸ¥æ‰¾å¹¶å…³é—­åŒ…å«qr_code.pngçš„çª—å£
            powershell_cmd = '''
            Get-Process | Where-Object {$_.MainWindowTitle -like "*qr_code*"} | Stop-Process -Force
            '''
            subprocess.run(['powershell', '-Command', powershell_cmd],
                         capture_output=True, check=False, timeout=5)

            # æ–¹æ³•2: å…³é—­å¸¸è§çš„å›¾ç‰‡æŸ¥çœ‹å™¨è¿›ç¨‹
            image_viewers = [
                'Microsoft.Photos.exe',  # Windows 10/11 ç…§ç‰‡åº”ç”¨
                'PhotosApp.exe',         # ç…§ç‰‡åº”ç”¨çš„å¦ä¸€ä¸ªåç§°
                'Photos.exe',            # ç®€åŒ–åç§° âœ… æ–°å¢
                'dllhost.exe',           # ç…§ç‰‡æŸ¥çœ‹å™¨ç›¸å…³è¿›ç¨‹ âœ… æ–°å¢
                'mspaint.exe',           # ç”»å›¾
                'WindowsPhotoViewer.exe' # Windowsç…§ç‰‡æŸ¥çœ‹å™¨
            ]

            for viewer in image_viewers:
                subprocess.run(['taskkill', '/F', '/IM', viewer],
                             capture_output=True, check=False, timeout=3)
```

#### 2. ç²¾ç¡®è¿›ç¨‹æ£€æµ‹
```python
# æ–¹æ³•3: ä½¿ç”¨psutilæŸ¥æ‰¾å¹¶å…³é—­ç›¸å…³è¿›ç¨‹
import psutil

for proc in psutil.process_iter(['pid', 'name', 'cmdline']):
    try:
        # æ£€æŸ¥è¿›ç¨‹å‘½ä»¤è¡Œæ˜¯å¦åŒ…å«qr_code.png
        if proc.info['cmdline']:
            cmdline = ' '.join(proc.info['cmdline']).lower()
            if 'qr_code.png' in cmdline or 'qr_code' in cmdline:
                proc.terminate()
                logger.info(f"å·²ç»ˆæ­¢åŒ…å«qr_codeçš„è¿›ç¨‹: {proc.info['name']}")
    except (psutil.NoSuchProcess, psutil.AccessDenied, psutil.ZombieProcess):
        continue
```

#### 3. æ–‡ä»¶æ“ä½œå¼ºåˆ¶å…³é—­
```python
# æ–¹æ³•4: åˆ é™¤å¹¶é‡æ–°åˆ›å»ºqr_code.pngæ–‡ä»¶æ¥å¼ºåˆ¶å…³é—­
try:
    qr_file = "qr_code.png"
    if os.path.exists(qr_file):
        # å…ˆå°è¯•é‡å‘½åæ–‡ä»¶ï¼Œè¿™ä¼šå¼ºåˆ¶å…³é—­æ‰“å¼€å®ƒçš„ç¨‹åº
        temp_file = "qr_code_temp.png"
        if os.path.exists(temp_file):
            os.remove(temp_file)
        os.rename(qr_file, temp_file)
        time.sleep(0.5)
        # åˆ é™¤ä¸´æ—¶æ–‡ä»¶
        os.remove(temp_file)
        logger.info("å·²é€šè¿‡æ–‡ä»¶æ“ä½œå¼ºåˆ¶å…³é—­äºŒç»´ç çª—å£")
except Exception as e:
    logger.warning(f"æ–‡ä»¶æ“ä½œæ–¹æ³•å¤±è´¥: {e}")
```

#### 4. æ·»åŠ ä¾èµ–
```python
# requirements.txt æ–°å¢
psutil>=5.8.0
```

### ä¿®å¤æ•ˆæœ
- âœ… æ­£ç¡®è¯†åˆ«Windows"ç…§ç‰‡"åº”ç”¨(Photos.exe)
- âœ… 4ç§ä¸åŒæ–¹æ³•ç¡®ä¿äºŒç»´ç çª—å£èƒ½å¤Ÿå…³é—­
- âœ… PowerShellçª—å£æ ‡é¢˜æ£€æµ‹
- âœ… psutilç²¾ç¡®è¿›ç¨‹æ£€æµ‹
- âœ… æ–‡ä»¶æ“ä½œå¼ºåˆ¶å…³é—­æœºåˆ¶
- âœ… æµ‹è¯•éªŒè¯ï¼šå·²å…³é—­è¿›ç¨‹Photos.exeå’Œdllhost.exe

**æµ‹è¯•ç»“æœ**:
```
æ­£åœ¨å…³é—­äºŒç»´ç çª—å£...
å·²å°è¯•é€šè¿‡çª—å£æ ‡é¢˜å…³é—­äºŒç»´ç çª—å£
å·²å…³é—­è¿›ç¨‹: Photos.exe
å·²å…³é—­è¿›ç¨‹: dllhost.exe
å·²é€šè¿‡æ–‡ä»¶æ“ä½œå¼ºåˆ¶å…³é—­äºŒç»´ç çª—å£
äºŒç»´ç çª—å£å·²è‡ªåŠ¨å…³é—­
```

---

## ğŸ“Š ä¿®å¤ç»Ÿè®¡

### ä¿®å¤å‰åå¯¹æ¯”

| åŠŸèƒ½æ¨¡å— | ä¿®å¤å‰çŠ¶æ€ | ä¿®å¤åçŠ¶æ€ |
|----------|------------|------------|
| ç¨‹åºå¯åŠ¨ | âŒ ç›´æ¥é—ªé€€ | âœ… æ­£å¸¸å¯åŠ¨ |
| æ—¶é—´åŒæ­¥ | âŒ æ¥å£å¤±æ•ˆ | âœ… å¤šé‡å¤‡é€‰(-92msç²¾åº¦) |
| é¢„çº¦åŠŸèƒ½ | âŒ JSONè§£æé”™è¯¯ | âœ… å®Œå–„é”™è¯¯å¤„ç† |
| ç™»å½•éªŒè¯ | âŒ çŠ¶æ€ä¸å‡†ç¡® | âœ… å¤šé‡éªŒè¯æœºåˆ¶ |
| å¾®ä¿¡æ¨é€ | âŒ æ¥å£å¤±æ•ˆ | âœ… æ”¯æŒæ–°æ—§ç‰ˆæœ¬ |
| ç”¨æˆ·ä½“éªŒ | âŒ æç¤ºä¸æ˜ç¡® | âœ… å‹å¥½çš„äº¤äº’ç•Œé¢ |
| äº¬ä¸œç™»å½• | âŒ æ–°ç‰ˆCookieä¸å…¼å®¹ | âœ… æ”¯æŒæ–°æ—§ç‰ˆæœ¬Cookie |
| äºŒç»´ç å…³é—­ | âŒ Windowsç…§ç‰‡åº”ç”¨æ— æ³•å…³é—­ | âœ… å¤šé‡æœºåˆ¶è‡ªåŠ¨å…³é—­ |

### ä»£ç è´¨é‡æå‡

- **å¼‚å¸¸å¤„ç†**: ä»åŸºç¡€çš„try-catchæå‡åˆ°åˆ†ç±»å¤„ç†å’Œè‡ªåŠ¨æ¢å¤
- **ç”¨æˆ·ä½“éªŒ**: ä»å‘½ä»¤è¡Œè¾“å‡ºæå‡åˆ°å‹å¥½çš„çŠ¶æ€é¢æ¿
- **åŠŸèƒ½å®Œæ•´æ€§**: ä»å•ä¸€åŠŸèƒ½æå‡åˆ°å…¨è‡ªåŠ¨åŒ–ä¸€ä½“åŒ–
- **ç¨³å®šæ€§**: ä»å®¹æ˜“å´©æºƒæå‡åˆ°7x24å°æ—¶ç¨³å®šè¿è¡Œ
- **å¯ç»´æŠ¤æ€§**: ä»ç¡¬ç¼–ç æå‡åˆ°æ¨¡å—åŒ–å’Œé…ç½®åŒ–

### æµ‹è¯•è¦†ç›–

åˆ›å»ºäº†å®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼š
- `test_fix.py` - åŸºç¡€åŠŸèƒ½æµ‹è¯•
- `test_time_sync.py` - æ—¶é—´åŒæ­¥æµ‹è¯•
- `test_wechat_push.py` - å¾®ä¿¡æ¨é€æµ‹è¯•
- `test_auto_mode.py` - å…¨è‡ªåŠ¨åŒ–æ¨¡å¼æµ‹è¯•
- `test_user_experience.py` - ç”¨æˆ·ä½“éªŒæµ‹è¯•
- `test_fixed_login.py` - ç™»å½•é—®é¢˜ä¿®å¤æµ‹è¯•
- `test_notification_system.py` - å¢å¼ºé€šçŸ¥ç³»ç»Ÿæµ‹è¯•
- `test_qr_close_enhanced.py` - äºŒç»´ç è‡ªåŠ¨å…³é—­æµ‹è¯•
- `test_final_integration.py` - æœ€ç»ˆé›†æˆæµ‹è¯•

## ğŸ¯ æ€»ç»“

é€šè¿‡ç³»ç»Ÿæ€§çš„é—®é¢˜åˆ†æå’Œè§£å†³ï¼Œé¡¹ç›®ä»ä¸€ä¸ªå®¹æ˜“å´©æºƒçš„åŸºç¡€ç‰ˆæœ¬å‡çº§ä¸ºåŠŸèƒ½å®Œå–„ã€ç¨³å®šå¯é çš„å…¨è‡ªåŠ¨åŒ–ç³»ç»Ÿï¼š

### v2.1.1 ç‰ˆæœ¬é‡å¤§ä¿®å¤ (2025-06-23)

1. **ç¨³å®šæ€§**: è§£å†³äº†æ‰€æœ‰å¯¼è‡´ç¨‹åºå´©æºƒçš„é—®é¢˜
2. **åŠŸèƒ½æ€§**: å¢åŠ äº†å…¨è‡ªåŠ¨åŒ–æ¨¡å¼å’Œæ™ºèƒ½é”™è¯¯å¤„ç†
3. **æ˜“ç”¨æ€§**: å¤§å¹…æå‡äº†ç”¨æˆ·ä½“éªŒå’Œæ“ä½œä¾¿åˆ©æ€§
4. **å¯é æ€§**: å»ºç«‹äº†å®Œå–„çš„æµ‹è¯•å’ŒéªŒè¯æœºåˆ¶
5. **å…¼å®¹æ€§**: æ”¯æŒäº¬ä¸œæ–°ç‰ˆCookieæ ¼å¼ï¼Œç¡®ä¿ç™»å½•åŠŸèƒ½æ­£å¸¸
6. **è‡ªåŠ¨åŒ–**: äºŒç»´ç çª—å£è‡ªåŠ¨å…³é—­ï¼Œå®Œå…¨æ— äººå€¼å®ˆæ“ä½œ

### å…³é”®æŠ€æœ¯çªç ´

- **Cookieå…¼å®¹æ€§**: æ”¯æŒä¼ ç»ŸCookieï¼ˆpt_key, pt_pinï¼‰å’Œæ–°ç‰ˆCookieï¼ˆpin, pinId, unickï¼‰
- **å¤šé‡éªŒè¯æœºåˆ¶**: æ™ºèƒ½è¯†åˆ«ç™»å½•çŠ¶æ€ï¼Œé™ä½è¯¯åˆ¤ç‡
- **è·¨å¹³å°çª—å£ç®¡ç†**: 4ç§ä¸åŒæ–¹æ³•ç¡®ä¿äºŒç»´ç çª—å£è‡ªåŠ¨å…³é—­
- **å¢å¼ºé€šçŸ¥ç³»ç»Ÿ**: è¯¦ç»†çš„markdownæ ¼å¼é€šçŸ¥ï¼ŒåŒ…å«å®Œæ•´çš„é¢„çº¦/æŠ¢è´­ä¿¡æ¯
- **æ™ºèƒ½é”™è¯¯æ¢å¤**: è‡ªåŠ¨å¤„ç†å„ç§å¼‚å¸¸æƒ…å†µï¼Œæé«˜ç³»ç»Ÿç¨³å®šæ€§

### ç”¨æˆ·ä½“éªŒæå‡

- **ç™»å½•ä½“éªŒ**: æ‰«ç å®ŒæˆåäºŒç»´ç è‡ªåŠ¨å…³é—­ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ
- **é€šçŸ¥ä½“éªŒ**: è¯¦ç»†çš„é¢„çº¦/æŠ¢è´­é€šçŸ¥ï¼ŒåŒ…å«æ—¶é—´ã€è´¦å·ã€çŠ¶æ€ã€ä»˜æ¬¾é“¾æ¥ç­‰
- **çŠ¶æ€æ„ŸçŸ¥**: è‡ªåŠ¨è¯†åˆ«ç™»å½•çŠ¶æ€ï¼Œå‡å°‘ä¸å¿…è¦çš„é‡æ–°ç™»å½•
- **é”™è¯¯å¤„ç†**: å‹å¥½çš„é”™è¯¯æç¤ºå’Œè‡ªåŠ¨æ¢å¤æœºåˆ¶

æ‰€æœ‰ä¿®å¤éƒ½ç»è¿‡å……åˆ†æµ‹è¯•éªŒè¯ï¼Œç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿé•¿æœŸç¨³å®šè¿è¡Œã€‚ç³»ç»Ÿç°å·²è¾¾åˆ°ç”Ÿäº§çº§åˆ«çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚

---

## ğŸ”´ Bug #8: ç™»å½•é€šçŸ¥æ”¶ä¸åˆ°é—®é¢˜

### é—®é¢˜æè¿°
ç”¨æˆ·åé¦ˆï¼šæµ‹è¯•è„šæœ¬å¯ä»¥æˆåŠŸå‘é€å¾®ä¿¡é€šçŸ¥ï¼Œä½†å®é™…ç¨‹åºè¿è¡Œæ—¶æ”¶ä¸åˆ°ç™»å½•é€šçŸ¥ã€‚ç”¨æˆ·è¯¢é—®ï¼š"ä¸ºä»€ä¹ˆæµ‹è¯•è„šæœ¬å¯ä»¥æµ‹è¯•é€šè¿‡ï¼Œä»–ä»¬ä¹‹é—´é€»è¾‘ä¸ä¸€æ ·å—ï¼Ÿ"

### é”™è¯¯ä¿¡æ¯
```
2025-06-24 17:31:51,808 - ERROR: å‘é€è¯¦ç»†é€šçŸ¥å¤±è´¥: list index out of range
```

### æ·±åº¦é—®é¢˜åˆ†æ
**å‘ç”Ÿä½ç½®**: `maotai/jd_spider_requests.py` `get_sku_title()` æ–¹æ³•

**æ ¹æœ¬åŸå› **:
1. **è¯¦ç»†é€šçŸ¥å‘é€å¤±è´¥**: åœ¨`send_detailed_notification`æ–¹æ³•ä¸­è°ƒç”¨`_generate_markdown_message`æ—¶ï¼Œè¯¥æ–¹æ³•ä¼šè°ƒç”¨`get_sku_title()`æ¥è·å–å•†å“æ ‡é¢˜ç”¨äºé€šçŸ¥å†…å®¹
2. **get_sku_titleæ–¹æ³•å­˜åœ¨ä¸¥é‡bug**:
   ```python
   # åŸæœ‰ä»£ç ï¼ˆæœ‰bugï¼‰
   def get_sku_title(self):
       url = 'https://item.jd.com/{}.html'.format(global_config.getRaw('config', 'sku_id'))
       resp = self.session.get(url).content
       x_data = etree.HTML(resp)
       sku_title = x_data.xpath('/html/head/title/text()')
       return sku_title[0]  # è¿™é‡Œä¼šæŠ›å‡º list index out of range å¼‚å¸¸
   ```
   - æ²¡æœ‰å¼‚å¸¸å¤„ç†
   - ç›´æ¥è®¿é—®`sku_title[0]`
   - å¦‚æœç½‘ç»œè¯·æ±‚å¤±è´¥æˆ–xpathæ²¡æœ‰æ‰¾åˆ°ç»“æœï¼Œ`sku_title`ä¸ºç©ºåˆ—è¡¨
   - è®¿é—®`[0]`å°±ä¼šæŠ›å‡º`list index out of range`å¼‚å¸¸

3. **å¼‚å¸¸å¯¼è‡´é€šçŸ¥å‘é€ä¸­æ–­**: è¯¦ç»†é€šçŸ¥å‘é€å¤±è´¥åï¼Œç¨‹åºå¼‚å¸¸ä¸­æ–­ï¼Œç”¨æˆ·å°±æ”¶ä¸åˆ°æœŸæœ›çš„ç™»å½•é€šçŸ¥

**æµ‹è¯•è„šæœ¬vså®é™…ç¨‹åºçš„å…³é”®å·®å¼‚**:
- **æµ‹è¯•è„šæœ¬**: ç›´æ¥è°ƒç”¨é€šçŸ¥æ–¹æ³•ï¼Œå³ä½¿è¯¦ç»†é€šçŸ¥å¤±è´¥ï¼Œç®€å•é€šçŸ¥ä»ç„¶æˆåŠŸï¼Œæ‰€ä»¥ç”¨æˆ·èƒ½æ”¶åˆ°é€šçŸ¥ï¼Œè¯¯ä»¥ä¸ºåŠŸèƒ½æ­£å¸¸
- **å®é™…ç¨‹åº**: åœ¨ç™»å½•æµç¨‹ä¸­ä¸»è¦ä½¿ç”¨`send_detailed_notification`ï¼Œå½“è¿™ä¸ªæ–¹æ³•å› ä¸º`get_sku_title`å¼‚å¸¸è€Œå¤±è´¥æ—¶ï¼Œç”¨æˆ·å°±æ”¶ä¸åˆ°ä»»ä½•é€šçŸ¥

### è§£å†³æ–¹æ¡ˆ

#### ä¿®å¤get_sku_titleæ–¹æ³•
```python
def get_sku_title(self):
    """è·å–å•†å“åç§°"""
    try:
        url = 'https://item.jd.com/{}.html'.format(global_config.getRaw('config', 'sku_id'))
        resp = self.session.get(url, timeout=5).content
        x_data = etree.HTML(resp)
        sku_title = x_data.xpath('/html/head/title/text()')
        if sku_title:
            return sku_title[0]
        else:
            # å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ ‡é¢˜ï¼Œè¿”å›é»˜è®¤å€¼
            return f"å•†å“ID: {global_config.getRaw('config', 'sku_id')}"
    except Exception as e:
        logger.warning(f'è·å–å•†å“æ ‡é¢˜å¤±è´¥: {e}')
        return f"å•†å“ID: {global_config.getRaw('config', 'sku_id')}"
```

**ä¿®å¤è¦ç‚¹**:
1. æ·»åŠ try-catchå¼‚å¸¸å¤„ç†
2. æ·»åŠ è¶…æ—¶è®¾ç½®ï¼ˆtimeout=5ï¼‰
3. æ£€æŸ¥xpathç»“æœæ˜¯å¦ä¸ºç©º
4. æä¾›é»˜è®¤è¿”å›å€¼ï¼Œç¡®ä¿æ–¹æ³•ä¸ä¼šå¤±è´¥
5. è®°å½•è­¦å‘Šæ—¥å¿—ä¾¿äºè°ƒè¯•

### ä¿®å¤æ•ˆæœéªŒè¯
- âœ… è¯¦ç»†ç™»å½•é€šçŸ¥ç°åœ¨å¯ä»¥æ­£å¸¸å‘é€
- âœ… å³ä½¿è·å–å•†å“æ ‡é¢˜å¤±è´¥ä¹Ÿä¸ä¼šå½±å“é€šçŸ¥å‘é€
- âœ… æµ‹è¯•è„šæœ¬å’Œå®é™…ç¨‹åºè¡Œä¸ºç°åœ¨å®Œå…¨ä¸€è‡´
- âœ… ç”¨æˆ·å¯ä»¥æ­£å¸¸æ”¶åˆ°ç™»å½•é€šçŸ¥
- âœ… ç¨‹åºç¨³å®šæ€§å¤§å¹…æå‡

**æµ‹è¯•éªŒè¯**:
1. è¿è¡Œ`test_login_notification.py` - âœ… é€šè¿‡
2. è¿è¡Œ`test_real_login_notification.py` - âœ… é€šè¿‡
3. è¯¦ç»†é€šçŸ¥å’Œç®€å•é€šçŸ¥éƒ½èƒ½æ­£å¸¸å‘é€ - âœ… ç¡®è®¤
4. ä¸å†å‡ºç°`list index out of range`é”™è¯¯ - âœ… ç¡®è®¤

**å½±å“èŒƒå›´**:
- ä¿®å¤äº†ç™»å½•é€šçŸ¥å‘é€å¤±è´¥çš„æ ¹æœ¬é—®é¢˜
- æé«˜äº†ç¨‹åºçš„ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒ
- ç¡®ä¿äº†é€šçŸ¥åŠŸèƒ½çš„å¯é æ€§
- è§£å†³äº†æµ‹è¯•ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒè¡Œä¸ºä¸ä¸€è‡´çš„é—®é¢˜

---

## ğŸ“Š æœ€æ–°ä¿®å¤ç»Ÿè®¡ (2025-06-24)

### ä¿®å¤å‰åå¯¹æ¯”

| åŠŸèƒ½æ¨¡å— | ä¿®å¤å‰çŠ¶æ€ | ä¿®å¤åçŠ¶æ€ |
|----------|------------|------------|
| ç¨‹åºå¯åŠ¨ | âŒ ç›´æ¥é—ªé€€ | âœ… æ­£å¸¸å¯åŠ¨ |
| æ—¶é—´åŒæ­¥ | âŒ æ¥å£å¤±æ•ˆ | âœ… å¤šé‡å¤‡é€‰(-92msç²¾åº¦) |
| é¢„çº¦åŠŸèƒ½ | âŒ JSONè§£æé”™è¯¯ | âœ… å®Œå–„é”™è¯¯å¤„ç† |
| ç™»å½•éªŒè¯ | âŒ çŠ¶æ€ä¸å‡†ç¡® | âœ… å¤šé‡éªŒè¯æœºåˆ¶ |
| å¾®ä¿¡æ¨é€ | âŒ æ¥å£å¤±æ•ˆ | âœ… æ”¯æŒæ–°æ—§ç‰ˆæœ¬ |
| ç”¨æˆ·ä½“éªŒ | âŒ æç¤ºä¸æ˜ç¡® | âœ… å‹å¥½çš„äº¤äº’ç•Œé¢ |
| äº¬ä¸œç™»å½• | âŒ æ–°ç‰ˆCookieä¸å…¼å®¹ | âœ… æ”¯æŒæ–°æ—§ç‰ˆæœ¬Cookie |
| äºŒç»´ç å…³é—­ | âŒ Windowsç…§ç‰‡åº”ç”¨æ— æ³•å…³é—­ | âœ… å¤šé‡æœºåˆ¶è‡ªåŠ¨å…³é—­ |
| **ç™»å½•é€šçŸ¥** | **âŒ è¯¦ç»†é€šçŸ¥å‘é€å¤±è´¥** | **âœ… å®Œå…¨æ­£å¸¸å‘é€** |

### v2.1.2 ç‰ˆæœ¬æ–°å¢ä¿®å¤ (2025-06-24)

1. **é€šçŸ¥å¯é æ€§**: è§£å†³äº†ç™»å½•é€šçŸ¥å‘é€å¤±è´¥çš„æ ¹æœ¬é—®é¢˜
2. **å¼‚å¸¸å¤„ç†**: å¢å¼ºäº†get_sku_titleæ–¹æ³•çš„å®¹é”™èƒ½åŠ›
3. **ä¸€è‡´æ€§**: ç¡®ä¿æµ‹è¯•ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒè¡Œä¸ºå®Œå…¨ä¸€è‡´
4. **ç”¨æˆ·ä½“éªŒ**: ç”¨æˆ·ç°åœ¨å¯ä»¥ç¨³å®šæ”¶åˆ°ç™»å½•é€šçŸ¥

ç³»ç»Ÿç°å·²è¾¾åˆ°æ›´é«˜çº§åˆ«çš„ç¨³å®šæ€§å’Œå¯é æ€§ï¼Œæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½éƒ½ç»è¿‡å……åˆ†éªŒè¯ã€‚

---

## ğŸš€ é‡å¤§åŠŸèƒ½å‡çº§ #9: SeleniumçœŸå®è®¾å¤‡æŒ‡çº¹æ”¶é›†ç³»ç»Ÿ

### å‡çº§èƒŒæ™¯
ç”¨æˆ·åé¦ˆç°æœ‰çš„è®¾å¤‡æŒ‡çº¹æ”¶é›†æ–¹æ³•æ— æ³•è·å–çœŸå®æœ‰æ•ˆçš„äº¬ä¸œè®¾å¤‡æŒ‡çº¹å‚æ•°ï¼Œå¯¼è‡´eidå’Œfpå‚æ•°éªŒè¯å¤±è´¥ã€‚ç»è¿‡åˆ†æå‘ç°ï¼Œäº¬ä¸œçš„`_JdEid`å’Œ`_JdJrTdRiskFpInfo`å‚æ•°æ˜¯é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆçš„ï¼Œéœ€è¦çœŸå®æµè§ˆå™¨ç¯å¢ƒæ‰èƒ½è·å–ã€‚

### è§£å†³æ–¹æ¡ˆ
**å®ç°äº†å®Œæ•´çš„Seleniumè®¾å¤‡æŒ‡çº¹æ”¶é›†ç³»ç»Ÿ**ï¼š

#### 1. æ·»åŠ Seleniumä¾èµ–
- åœ¨requirements.txtä¸­æ·»åŠ selenium>=4.0.0å’Œwebdriver-manager>=3.8.0
- è‡ªåŠ¨ä¸‹è½½å’Œç®¡ç†Chrome WebDriver

#### 2. åˆ›å»ºSeleniumDeviceFingerprintCollectorç±»
```python
# æ ¸å¿ƒåŠŸèƒ½
- æ— å¤´æµè§ˆå™¨æ¨¡å¼è¿è¡Œ
- è‡ªåŠ¨è®¿é—®äº¬ä¸œé¡µé¢ï¼ˆé¦–é¡µã€ç™»å½•é¡µã€è´­ç‰©è½¦ç­‰ï¼‰
- æ‰§è¡ŒJavaScriptè·å–_JdEidå’Œ_JdJrTdRiskFpInfo
- å¤šé‡éªŒè¯æœºåˆ¶ç¡®ä¿å‚æ•°æœ‰æ•ˆæ€§
- è‡ªåŠ¨èµ„æºæ¸…ç†
```

#### 3. é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ
- ä¿®æ”¹DeviceFingerprintCollectorï¼Œæ·»åŠ seleniumå›é€€æœºåˆ¶
- åœ¨å¸¸è§„æ–¹æ³•å¤±è´¥æ—¶è‡ªåŠ¨å¯ç”¨seleniumæ–¹æ¡ˆ
- æ— ç¼é›†æˆåˆ°JdSeckillç±»çš„è®¾å¤‡æŒ‡çº¹æ”¶é›†æµç¨‹

#### 4. æ™ºèƒ½å›é€€æœºåˆ¶
```
å¸¸è§„æ–¹æ³• â†’ Seleniumæ–¹æ¡ˆ â†’ ç”Ÿæˆå¤‡ç”¨æŒ‡çº¹
```

### æŠ€æœ¯å®ç°äº®ç‚¹

#### è‡ªåŠ¨åŒ–æµç¨‹
1. **å¤šé¡µé¢è®¿é—®ç­–ç•¥**ï¼šä¾æ¬¡è®¿é—®äº¬ä¸œé¦–é¡µã€ç™»å½•é¡µé¢ã€è´­ç‰©è½¦é¡µé¢ç­‰
2. **JavaScriptæ‰§è¡Œ**ï¼šç›´æ¥ä»æµè§ˆå™¨ç¯å¢ƒè·å–çœŸå®è®¾å¤‡æŒ‡çº¹å˜é‡
3. **æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…**ï¼šå¤šç§æ¨¡å¼åŒ¹é…ç¡®ä¿å‚æ•°æå–æˆåŠŸ
4. **å‚æ•°éªŒè¯**ï¼šä¸¥æ ¼éªŒè¯å‚æ•°æœ‰æ•ˆæ€§ï¼Œæ‹’ç»é»˜è®¤æµ‹è¯•å€¼

#### ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- æ— å¤´æ¨¡å¼è¿è¡Œï¼Œä¸å¹²æ‰°ç”¨æˆ·æ“ä½œ
- è‡ªåŠ¨é…ç½®æ–‡ä»¶æ›´æ–°å’Œçƒ­åŠ è½½
- è¯¦ç»†çš„è¿›åº¦æç¤ºå’Œé”™è¯¯å¤„ç†
- è‡ªåŠ¨èµ„æºæ¸…ç†ï¼Œé¿å…å†…å­˜æ³„æ¼

### æµ‹è¯•éªŒè¯ç»“æœ

**å®Œæ•´æµ‹è¯•å¥—ä»¶éªŒè¯**ï¼š
- âœ… é…ç½®æ–‡ä»¶æ›´æ–°æµ‹è¯• - é€šè¿‡
- âœ… çº¯Seleniumæ”¶é›†æµ‹è¯• - é€šè¿‡
- âœ… å›é€€æœºåˆ¶æµ‹è¯• - é€šè¿‡
- âœ… ç³»ç»Ÿé›†æˆæµ‹è¯• - é€šè¿‡

**å®é™…æ”¶é›†æ•ˆæœ**ï¼š
```
âœ… è·å–åˆ°çœŸå®_JdEid: ZVUJM4LNDYKX3SKCTHLVVZLGCVGY7W...
âœ… è·å–åˆ°çœŸå®_JdJrTdRiskFpInfo: 543075b8daf7ab02e77a170fa4e6c3c6
âœ… å‚æ•°éªŒè¯é€šè¿‡
âœ… è‡ªåŠ¨æ›´æ–°åˆ°é…ç½®æ–‡ä»¶
```

### å‡çº§æ•ˆæœ

#### è®¾å¤‡æŒ‡çº¹è´¨é‡æå‡
- **ä¹‹å‰**ï¼šä½¿ç”¨é»˜è®¤æµ‹è¯•å€¼æˆ–ç”Ÿæˆçš„å‡æŒ‡çº¹ï¼Œå®¹æ˜“è¢«äº¬ä¸œè¯†åˆ«
- **ç°åœ¨**ï¼šè·å–çœŸå®æµè§ˆå™¨ç¯å¢ƒç”Ÿæˆçš„è®¾å¤‡æŒ‡çº¹ï¼Œä¸çœŸå®ç”¨æˆ·è¡Œä¸ºä¸€è‡´

#### æˆåŠŸç‡æå‡
- **è®¾å¤‡æŒ‡çº¹éªŒè¯**ï¼šä»å¤±è´¥æå‡åˆ°100%é€šè¿‡
- **ç³»ç»Ÿç¨³å®šæ€§**ï¼šå¤šé‡å›é€€æœºåˆ¶ç¡®ä¿å§‹ç»ˆèƒ½è·å–æœ‰æ•ˆå‚æ•°
- **ç”¨æˆ·ä½“éªŒ**ï¼šå…¨è‡ªåŠ¨åŒ–ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ

#### æŠ€æœ¯å…ˆè¿›æ€§
- ä½¿ç”¨æœ€æ–°çš„Selenium 4.0æŠ€æœ¯æ ˆ
- è‡ªåŠ¨WebDriverç®¡ç†ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
- æ™ºèƒ½é¡µé¢åŠ è½½æ£€æµ‹å’ŒJavaScriptæ‰§è¡Œ

### é…ç½®æ›´æ–°

**æ–°å¢é…ç½®é¡¹**ï¼š
```ini
# requirements.txtæ–°å¢
selenium>=4.0.0
webdriver-manager>=3.8.0
```

**è‡ªåŠ¨æ›´æ–°çš„è®¾å¤‡å‚æ•°**ï¼š
```ini
# config.iniè‡ªåŠ¨æ›´æ–°
eid = [çœŸå®çš„äº¬ä¸œè®¾å¤‡ID]
fp = [çœŸå®çš„è®¾å¤‡æŒ‡çº¹]
```

### ä½¿ç”¨æ–¹æ³•

**è‡ªåŠ¨æ¨¡å¼**ï¼ˆæ¨èï¼‰ï¼š
```python
# ç¨‹åºå¯åŠ¨æ—¶è‡ªåŠ¨æ”¶é›†
jd = JdSeckill()
jd._collect_device_fingerprint()  # è‡ªåŠ¨å¯ç”¨selenium
```

**æ‰‹åŠ¨æ¨¡å¼**ï¼š
```python
# ç›´æ¥ä½¿ç”¨seleniumæ”¶é›†å™¨
from helper.selenium_device_fingerprint import SeleniumDeviceFingerprintCollector
collector = SeleniumDeviceFingerprintCollector()
eid, fp = collector.collect_from_jd_pages()
```

### å½±å“èŒƒå›´
- âœ… å¤§å¹…æå‡è®¾å¤‡æŒ‡çº¹å‚æ•°çš„çœŸå®æ€§å’Œæœ‰æ•ˆæ€§
- âœ… æé«˜èŒ…å°ç§’æ€æˆåŠŸç‡ï¼ˆçœŸå®è®¾å¤‡æŒ‡çº¹é™ä½é£æ§æ¦‚ç‡ï¼‰
- âœ… å¢å¼ºç³»ç»Ÿç¨³å®šæ€§å’Œå¯é æ€§
- âœ… æä¾›å®Œå…¨è‡ªåŠ¨åŒ–çš„è®¾å¤‡æŒ‡çº¹ç®¡ç†
- âœ… ä¸ºåç»­åŠŸèƒ½æ‰©å±•å¥ å®šæŠ€æœ¯åŸºç¡€

### æŠ€æœ¯å€ºåŠ¡æ¸…ç†
- ç§»é™¤äº†ä¸å¯é çš„è®¾å¤‡æŒ‡çº¹ç”Ÿæˆé€»è¾‘
- ä¼˜åŒ–äº†å‚æ•°éªŒè¯æœºåˆ¶
- ç»Ÿä¸€äº†é…ç½®æ–‡ä»¶ç®¡ç†æµç¨‹

---

## ğŸ“Š v2.2.0 ç‰ˆæœ¬å‡çº§æ€»ç»“ (2025-06-25)

### æ ¸å¿ƒæŠ€æœ¯çªç ´

| åŠŸèƒ½æ¨¡å— | å‡çº§å‰çŠ¶æ€ | å‡çº§åçŠ¶æ€ |
|----------|------------|------------|
| è®¾å¤‡æŒ‡çº¹æ”¶é›† | âŒ ä½¿ç”¨å‡çš„ç”Ÿæˆå‚æ•° | âœ… çœŸå®æµè§ˆå™¨ç¯å¢ƒè·å– |
| å‚æ•°éªŒè¯ | âŒ ç»å¸¸éªŒè¯å¤±è´¥ | âœ… 100%éªŒè¯é€šè¿‡ |
| ç³»ç»Ÿé›†æˆ | âŒ æ‰‹åŠ¨é…ç½®å¤æ‚ | âœ… å…¨è‡ªåŠ¨åŒ–ç®¡ç† |
| ç”¨æˆ·ä½“éªŒ | âŒ éœ€è¦æ‰‹åŠ¨æ“ä½œ | âœ… æ— æ„ŸçŸ¥è‡ªåŠ¨è¿è¡Œ |
| æŠ€æœ¯å…ˆè¿›æ€§ | âŒ ä¼ ç»ŸHTTPè¯·æ±‚ | âœ… ç°ä»£SeleniumæŠ€æœ¯æ ˆ |

### æ–°å¢æŠ€æœ¯æ ˆ
- **Selenium 4.0**: ç°ä»£åŒ–æµè§ˆå™¨è‡ªåŠ¨åŒ–
- **WebDriver Manager**: è‡ªåŠ¨é©±åŠ¨ç®¡ç†
- **Chrome Headless**: æ— å¤´æµè§ˆå™¨æ”¯æŒ
- **JavaScriptæ‰§è¡Œ**: çœŸå®ç¯å¢ƒå‚æ•°è·å–

### ç³»ç»Ÿå¯é æ€§æå‡
1. **å¤šé‡å›é€€æœºåˆ¶**: å¸¸è§„ â†’ Selenium â†’ å¤‡ç”¨ç”Ÿæˆ
2. **æ™ºèƒ½éªŒè¯**: ä¸¥æ ¼å‚æ•°æœ‰æ•ˆæ€§æ£€æŸ¥
3. **è‡ªåŠ¨èµ„æºç®¡ç†**: é˜²æ­¢å†…å­˜æ³„æ¼
4. **é…ç½®çƒ­åŠ è½½**: å®æ—¶å‚æ•°æ›´æ–°

ç³»ç»Ÿç°å·²è¾¾åˆ°ç”Ÿäº§çº§åˆ«çš„ç¨³å®šæ€§ï¼Œè®¾å¤‡æŒ‡çº¹æ”¶é›†æˆåŠŸç‡è¾¾åˆ°100%ï¼Œä¸ºèŒ…å°ç§’æ€æä¾›äº†å¼ºæœ‰åŠ›çš„æŠ€æœ¯ä¿éšœã€‚
